<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Start Page</title>
  <style>
    body { background:#0b0c0f; color:#e6e9ef; font-family:system-ui, sans-serif; margin:0; }
    header, footer { text-align:center; padding:1em; }
    .grid { display:flex; flex-wrap:wrap; gap:1em; justify-content:center; padding:1em; }
    .card { background:#171922; padding:1em; border-radius:10px; width:200px; text-align:center; cursor:pointer; }
    .favicon img { width:32px; height:32px; border-radius:8px; }
  </style>
</head>
<body>
  <header>
    <h1>My Start Page</h1>
    <button id="addBtn">Add</button>
  </header>

  <main class="grid" id="grid"></main>

  <dialog id="editor">
    <form method="dialog" id="editorForm">
      <label>Name <input id="name" required></label><br>
      <label>URL <input id="url" type="url" required></label><br>
      <label>Icon URL (optional) <input id="icon" type="text" placeholder="URL, ./icons/mysite.png, or data:image/png;base64,â€¦"></label><br>
      <input id="iconFile" type="file" accept="image/*">
      <menu>
        <button value="cancel">Cancel</button>
        <button value="default">Save</button>
      </menu>
    </form>
  </dialog>

  <footer>Data stored locally (no servers involved).</footer>

  <script>
    const grid = document.getElementById('grid');
    const addBtn = document.getElementById('addBtn');
    const editor = document.getElementById('editor');
    const nameInput = document.getElementById('name');
    const urlInput = document.getElementById('url');
    const iconInput = document.getElementById('icon');
    const iconFile = document.getElementById('iconFile');

    const STORE_KEY = 'favoriteLinks.v2';
    let links = JSON.parse(localStorage.getItem(STORE_KEY) || '[]');

    if (!links.length) {
      links = [
        { name:'Google', url:'https://www.google.com' },
        { name:'YouTube', url:'https://www.youtube.com' }
      ];
    }

    function save(){ localStorage.setItem(STORE_KEY, JSON.stringify(links)); }

    async function imageFileToDataURL(file) {
      return new Promise((resolve, reject) => {
        const fr = new FileReader();
        fr.onload = () => resolve(fr.result);
        fr.onerror = () => reject('Failed');
        fr.readAsDataURL(file);
      });
    }

    if(iconFile){
      iconFile.addEventListener('change', async (e)=>{
        const file = e.target.files?.[0];
        if(!file) return;
        const dataUrl = await imageFileToDataURL(file);
        iconInput.value = dataUrl;
      });
    }

    function render(){
      grid.innerHTML = '';
      links.forEach((link, i)=>{
        const card = document.createElement('div');
        card.className = 'card';

        const fav = document.createElement('div');
        fav.className = 'favicon';
        if(link.icon){
          const img = document.createElement('img');
          img.src = link.icon;
          img.alt = '';
          fav.appendChild(img);
        } else {
          fav.textContent = link.name[0];
        }

        const title = document.createElement('div');
        title.textContent = link.name;

        card.append(fav, title);
        card.onclick = ()=> window.open(link.url, '_blank');
        grid.appendChild(card);
      });
    }

    addBtn.onclick = ()=>{
      nameInput.value = '';
      urlInput.value = '';
      iconInput.value = '';
      editor.showModal();
    };

    editor.addEventListener('close', ()=>{
      if(editor.returnValue === 'default'){
        const name = nameInput.value.trim();
        const url = urlInput.value.trim();
        const icon = iconInput.value.trim();
        if(name && url){
          links.push({ name, url, icon });
          save();
          render();
        }
      }
    });

    render();
  </script>
</body>
</html>
