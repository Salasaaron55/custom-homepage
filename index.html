<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>My Start Page</title>
  <style>
    :root{
      --bg: #0b0c0f;
      --bg-elev: #12141a;
      --text: #e6e9ef;
      --muted: #9aa3b2;
      --accent: #4f8cff;
      --card: #171922;
      --ring: #4f8cff55;
      --danger: #ff5c7a;
      --ok: #26c281;
    }
    @media (prefers-color-scheme: light){
      :root{
        --bg: #f7f8fb;
        --bg-elev: #fff;
        --text: #0c0d0f;
        --muted: #5a6473;
        --accent: #2b6cff;
        --card: #ffffff;
        --ring: #2b6cff44;
        --danger: #d62839;
        --ok: #209f5e;
      }
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font: 16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color:var(--text); background: radial-gradient(1200px 800px at 100% -10%, #2a2f45 0%, transparent 60%), var(--bg);
      display:flex; flex-direction:column; min-height:100%;
    }
    header{
      position:sticky; top:0; z-index:10;
      backdrop-filter: saturate(140%) blur(8px);
      background: color-mix(in oklab, var(--bg-elev) 70%, transparent);
      border-bottom: 1px solid color-mix(in oklab, var(--muted) 25%, transparent);
    }
    .wrap{ max-width: 1100px; margin: 0 auto; padding: 16px; }
    .toolbar{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .title{ font-weight:700; letter-spacing:.2px; font-size: clamp(18px, 3vw, 22px); margin-right:auto; display:flex; align-items:center; gap:10px; }
    .title input{
      background: transparent; border:none; outline:none; color:var(--text); font: inherit; border-bottom:1px dashed color-mix(in oklab, var(--text) 40%, transparent);
      width: min(360px, 50vw);
    }
    .btn{
      appearance:none; border:1px solid color-mix(in oklab, var(--muted) 35%, transparent); background: var(--bg-elev);
      color:var(--text); padding:8px 12px; border-radius: 10px; cursor:pointer; display:inline-flex; align-items:center; gap:8px; transition: .15s ease;
    }
    .btn:hover{ transform: translateY(-1px); box-shadow: 0 6px 18px -10px var(--ring); }
    .btn[aria-pressed="true"], .btn.primary{ border-color: transparent; background: linear-gradient(180deg, color-mix(in oklab, var(--accent) 20%, var(--bg-elev)), var(--accent)); color:white; }
    .btn.danger{ background: linear-gradient(180deg, color-mix(in oklab, var(--danger) 15%, var(--bg-elev)), var(--danger)); color:white; border-color:transparent; }
    .btn.flat{ background: transparent; border-color: transparent; }

    .grid{
      display:grid; gap:14px; grid-template-columns: repeat(auto-fill, minmax(210px, 1fr));
      padding: 22px 16px 30px; width: min(1100px, 100%); margin: 0 auto; flex:1;
    }

    /* Card now a full-image tile */
    .card{
      position:relative;
      background: var(--card);
      border:1px solid color-mix(in oklab, var(--muted) 22%, transparent);
      border-radius: 16px; overflow:hidden;
      cursor:pointer;
      display:block;
      min-height: 140px; /* ensures some presence even for tiny images */
    }
    .card:hover{ box-shadow: 0 10px 30px -18px var(--ring); transform: translateY(-1px); }

    /* Big image that fits inside without distortion */
    .thumb{
      position:relative; width:100%; height:100%;
      display:grid; place-items:center;
      background:
        linear-gradient(180deg, color-mix(in oklab, var(--bg) 70%, transparent), transparent),
        var(--bg-elev);
      aspect-ratio: 16 / 10; /* nice default; card grows consistently */
    }
    .thumb img{
      max-width: 100%;
      max-height: 100%;
      width:auto; height:auto;
      object-fit: contain; /* keeps aspect ratio, no cropping */
      display:block;
    }

    /* Fallback large initial if image missing */
    .fallback-initial{
      font-weight:800; font-size: 48px; line-height:1; opacity:.9;
      color: color-mix(in oklab, var(--text) 88%, transparent);
      text-shadow: 0 2px 10px rgba(0,0,0,.35);
      user-select:none;
    }

    /* Caption bar overlay */
    .caption{
      position:absolute; left:0; right:0; bottom:0;
      background: linear-gradient(180deg, transparent, color-mix(in oklab, #000 55%, var(--bg-elev)));
      padding: 10px 12px 12px;
      display:flex; flex-direction:column; gap:2px;
    }
    .name{ font-weight:700; text-shadow: 0 2px 10px rgba(0,0,0,.35); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .url{ font-size:12px; color:var(--muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }

    /* Edit mode decorations (repositioned to overlay) */
    .edit-badges{ position:absolute; inset:10px auto auto 10px; display:flex; gap:6px; z-index:2; }
    .pill{ font-size:11px; padding:4px 8px; border-radius:999px; border:1px solid color-mix(in oklab, var(--muted) 30%, transparent); background: var(--bg-elev); color:var(--muted); }

    .actions{ position:absolute; inset:10px 10px auto auto; display:flex; gap:6px; z-index:2; }
    .icon-btn{ width:34px; height:34px; display:grid; place-items:center; border-radius:10px; border:1px solid color-mix(in oklab, var(--muted) 35%, transparent); background: var(--bg-elev); cursor:pointer; }
    .icon-btn:hover{ box-shadow: 0 6px 18px -10px var(--ring); }

    .dragging{ opacity:.6; outline: 2px dashed var(--accent); }
    .drop-target{ outline: 2px dashed var(--accent); outline-offset: 4px; }

    dialog{
      border:none; border-radius: 16px; padding:0; box-shadow: 0 30px 60px -35px rgba(0,0,0,.6);
      background: var(--bg-elev); color:var(--text); width:min(560px, 96vw);
    }
    .dlg-head{ padding:16px 18px; border-bottom:1px solid color-mix(in oklab, var(--muted) 25%, transparent); font-weight:700; display:flex; justify-content:space-between; align-items:center; }
    .dlg-body{ padding:16px 18px; display:grid; gap:12px; }
    .field{ display:grid; gap:6px; }
    label{ font-size:12px; color:var(--muted); }
    input[type="text"], input[type="url"]{
      width:100%; padding:10px 12px; border-radius:10px; background: var(--bg); color: var(--text);
      border:1px solid color-mix(in oklab, var(--muted) 30%, transparent);
    }
    .icon-row{ display:grid; gap:8px; }
    .icon-tools{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
    .icon-preview{ width:48px; height:48px; border-radius:10px; border:1px solid color-mix(in oklab, var(--muted) 30%, transparent); display:none; object-fit: contain; background: var(--bg); }
    .hint{ font-size:11px; color:var(--muted); }

    footer{ color:var(--muted); text-align:center; padding: 10px 0 22px; font-size: 12px; }
    .search{ position: relative; flex: 1 1 260px; min-width: 220px; }
    .search input{ width:100%; padding:10px 12px 10px 36px; border-radius:10px; background: var(--bg-elev); color: var(--text);
      border:1px solid color-mix(in oklab, var(--muted) 30%, transparent); }
    .search svg{ position:absolute; left:10px; top:50%; transform: translateY(-50%); opacity:.7 }
    .hidden{ display:none !important }
  </style>
</head>
<body>
  <header>
    <div class="wrap toolbar">
      <div class="title">
        <span>üè†</span>
        <input id="pageTitle" aria-label="Page title" />
      </div>
      <div class="search" role="search">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg>
        <input id="search" placeholder="Filter links‚Ä¶ (‚åò/Ctrl+K)" autocomplete="off" />
      </div>
      <button class="btn" id="addBtn">‚ûï Add</button>
      <button class="btn" id="editToggle" aria-pressed="false">‚úèÔ∏è Edit mode</button>
      <button class="btn" id="exportBtn" title="Export as JSON">‚¨áÔ∏è Export</button>
      <label class="btn" for="importFile" title="Import from JSON">‚¨ÜÔ∏è Import<input id="importFile" type="file" accept="application/json" hidden></label>
      <button class="btn danger" id="resetBtn" title="Restore starter links">‚ü≤ Reset</button>
    </div>
  </header>

  <main class="grid" id="grid" aria-live="polite"></main>

  <footer>Data is stored locally in your browser (localStorage). No servers involved.</footer>

  <!-- Add/Edit Dialog -->
  <dialog id="editor">
    <form method="dialog" id="editorForm">
      <div class="dlg-head">
        <span id="dlgTitle">Add Link</span>
        <button class="btn flat" value="cancel" aria-label="Close">‚úï</button>
      </div>
      <div class="dlg-body">
        <div class="field">
          <label for="name">Name</label>
          <input id="name" name="name" type="text" required maxlength="80" />
        </div>
        <div class="field">
          <label for="url">URL</label>
          <input id="url" name="url" type="url" inputmode="url" placeholder="https://example.com" required />
        </div>

        <!-- Icon controls -->
        <div class="field icon-row">
          <label for="icon">Icon / Image (optional)</label>
          <input id="icon" name="icon" type="text" inputmode="url"
                 placeholder="https://‚Ä¶  or  ./icons/mysite.png  or  data:image/png;base64,‚Ä¶" />
          <div class="icon-tools">
            <img id="iconPreview" class="icon-preview" alt="icon preview">
            <label class="btn" for="iconFile">üìÅ Choose file
              <input id="iconFile" type="file" accept="image/*" hidden>
            </label>
            <button class="btn flat" type="button" id="clearIconBtn" title="Remove custom icon">üßπ Clear</button>
          </div>
          <div class="hint">If no custom image is set, the site‚Äôs favicon is used. Cards display the image as large as possible without cropping or distortion.</div>
        </div>
      </div>
      <div class="dlg-foot">
        <button class="btn" value="cancel">Cancel</button>
        <button class="btn primary" id="saveBtn" value="default">Save</button>
      </div>
    </form>
  </dialog>

  <script>
  (function(){
    const STORE_KEY_V3 = 'favoriteLinks.v3';
    const STORE_KEY_V2 = 'favoriteLinks.v2';
    const STORE_KEY_V1 = 'favoriteLinks.v1';
    const TITLE_KEY = 'favoriteLinks.title';

    /** @typedef {{id:string,name:string,url:string,icon?:string}} Link */
    /** @type {Link[]} */
    let links = [];
    let editMode = false;
    let editingId = null;

    const grid = document.getElementById('grid');
    const editor = document.getElementById('editor');
    const editorForm = document.getElementById('editorForm');
    const dlgTitle = document.getElementById('dlgTitle');
    const nameInput = document.getElementById('name');
    const urlInput = document.getElementById('url');
    const iconInput = document.getElementById('icon');
    const iconFile = document.getElementById('iconFile');
    const iconPreview = document.getElementById('iconPreview');
    const clearIconBtn = document.getElementById('clearIconBtn');

    const addBtn = document.getElementById('addBtn');
    const editToggle = document.getElementById('editToggle');
    const exportBtn = document.getElementById('exportBtn');
    const importFile = document.getElementById('importFile');
    const resetBtn = document.getElementById('resetBtn');
    const searchInput = document.getElementById('search');
    const pageTitle = document.getElementById('pageTitle');

    const uid = () => Math.random().toString(36).slice(2, 9);
    const norm = s => (s||'').trim();
    const hostname = (u)=>{ try{ return new URL(u).hostname.replace(/^www\./,''); }catch{ return u; } };

    function starterData(){
      return [
        { id: uid(), name:'Google', url:'https://www.google.com' },
        { id: uid(), name:'YouTube', url:'https://www.youtube.com' },
        { id: uid(), name:'Reddit', url:'https://www.reddit.com' },
        { id: uid(), name:'Gmail', url:'https://mail.google.com' },
        { id: uid(), name:'GitHub', url:'https://github.com' },

      
